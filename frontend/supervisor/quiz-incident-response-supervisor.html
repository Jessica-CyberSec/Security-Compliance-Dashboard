<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>üö® Incident Response Quiz for Supervisors</title>
  <link rel="stylesheet" href="../style_updated_v2.css" />
  <style>
    body{
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      margin:0;
      background: radial-gradient(1200px 800px at 10% -10%, #fff3e0 0%, #fbe9e7 35%, #f3e5f5 100%);
      color:#333;
    }
    .box{
      max-width: 900px; margin: 48px auto; background:#fff; border-radius:20px;
      box-shadow:0 18px 40px rgba(80,0,120,.12); padding:32px; overflow:hidden;
    }
    h2{margin:0 0 10px; color:#6a1b9a;}
    .sub{
      color:#6a1b9a; font-weight:600; margin:2px 0 18px; display:flex; gap:16px; align-items:center; flex-wrap:wrap;
    }
    .pill{background:#ede7f6; color:#4a148c; padding:6px 12px; border-radius:999px; font-size:13px;}
    /* Progress */
    .progress-wrap{margin:18px 0 22px;}
    .progress-meta{display:flex; justify-content:space-between; font-size:14px; color:#6a1b9a; margin-bottom:6px;}
    .progress{
      height:12px; background:#f3e5f5; border-radius:999px; overflow:hidden;
    }
    .progress > span{
      display:block; height:100%; width:0%;
      background: linear-gradient(90deg,#8e24aa,#6a1b9a);
      transition:width .35s ease;
    }
    /* Gamification header */
    .gamify{
      display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin:8px 0 20px;
    }
    .stat{
      background:#fff8e1; color:#ef6c00; border:1px solid #ffe0b2;
      padding:6px 10px; border-radius:10px; font-weight:600; font-size:13px;
    }
    .stars{letter-spacing:2px; font-size:18px;}
    /* Questions */
    .question-block{
      background:#fafafa; border:1px solid #eee; padding:18px; border-radius:14px;
      margin:18px 0; transition: box-shadow .2s ease, transform .05s ease;
    }
    .question-block:hover{ box-shadow:0 8px 18px rgba(0,0,0,.06); transform: translateY(-1px); }
    .question-block h3{margin:0 0 10px; color:#4a148c;}
    .option{display:block; padding:10px 12px; border-radius:10px; border:1px solid #e9e9e9; margin:8px 0; cursor:pointer;}
    .option input{margin-right:10px; accent-color:#6a1b9a;}
    .option:hover{background:#f7f2ff;}
    /* CTA */
    .actions{ display:flex; justify-content:center; gap:12px; margin-top:26px; }
    .button{
      padding:14px 22px; font-size:16px; border:none; border-radius:12px; cursor:pointer;
      background:#6a1b9a; color:#fff; box-shadow:0 8px 16px rgba(106,27,154,.25);
      transition: transform .05s ease, background .2s ease;
    }
    .button:hover{ background:#4a148c; }
    .button:disabled{ background:#b39ddb; cursor:not-allowed; box-shadow:none; }
    /* Result */
    .result-box{
      display:none; margin-top:24px; padding:20px; border-radius:14px; text-align:center;
      font-weight:600; background:#f3e5f5; color:#4a148c; border:1px dashed #ce93d8;
    }
    .badge{
      display:inline-flex; align-items:center; gap:8px; margin-top:10px;
      background:#fff3e0; color:#ef6c00; padding:8px 12px; border-radius:999px; font-size:13px; border:1px solid #ffe0b2;
    }
    .tiny{font-size:12px; color:#6a1b9a; margin-left:auto;}
  </style>
</head>
<body>
  <div class="box">
    <h2>üö® Incident Response Quiz for Supervisors</h2>
    <div class="sub">
      <span class="pill">Challenge Mode</span>
      <span class="pill" id="answeredPill">0/5 answered</span>
      <span class="pill">Earn: <strong>Incident Commander</strong> ü•á (Perfect)</span>
      <span class="tiny" id="whoami"></span>
    </div>

    <!-- Progress + Gamification -->
    <div class="progress-wrap">
      <div class="progress-meta">
        <span>Progress</span>
        <span id="progressPct">0%</span>
      </div>
      <div class="progress"><span id="progressBar"></span></div>
    </div>
    <div class="gamify">
      <div class="stat">‚≠ê Stars: <span id="starCount">0</span></div>
      <div class="stat">üéØ Goal: 5/5</div>
    </div>

    <!-- QUIZ -->
    <form id="quizForm">
      <!-- Hidden context (filled from URL) -->
      <input type="hidden" name="topic" value="Incident Response">
      <input type="hidden" name="username" value="">
      <input type="hidden" name="jobid" value="">
      <input type="hidden" name="role" value="Supervisors">

      <div class="question-block" data-q="q1">
        <h3>1) What's the first step when a cyber incident occurs?</h3>
        <label class="option"><input type="radio" name="q1" value="Tell a friend" required> Tell a friend</label>
        <label class="option"><input type="radio" name="q1" value="Document everything" required> Document everything</label>
        <label class="option"><input type="radio" name="q1" value="Shut down the company" required> Shut down the company</label>
      </div>

      <div class="question-block" data-q="q2">
        <h3>2) Who should you contact after noticing an incident?</h3>
        <label class="option"><input type="radio" name="q2" value="Your customers" required> Your customers</label>
        <label class="option"><input type="radio" name="q2" value="Cybersecurity or IT team" required> Cybersecurity or IT team</label>
        <label class="option"><input type="radio" name="q2" value="Nobody" required> Nobody</label>
      </div>

      <div class="question-block" data-q="q3">
        <h3>3) What should be done with affected systems?</h3>
        <label class="option"><input type="radio" name="q3" value="Keep them connected" required> Keep them connected</label>
        <label class="option"><input type="radio" name="q3" value="Isolate if instructed" required> Isolate if instructed</label>
        <label class="option"><input type="radio" name="q3" value="Throw them away" required> Throw them away</label>
      </div>

      <div class="question-block" data-q="q4">
        <h3>4) What is the role of documentation in incident response?</h3>
        <label class="option"><input type="radio" name="q4" value="To delay action" required> To delay action</label>
        <label class="option"><input type="radio" name="q4" value="To support investigation" required> To support investigation</label>
        <label class="option"><input type="radio" name="q4" value="To waste time" required> To waste time</label>
      </div>

      <div class="question-block" data-q="q5">
        <h3>5) How can you prevent future incidents?</h3>
        <label class="option"><input type="radio" name="q5" value="Do nothing" required> Do nothing</label>
        <label class="option"><input type="radio" name="q5" value="Follow up with IT and train staff" required> Follow up with IT and train staff</label>
        <label class="option"><input type="radio" name="q5" value="Forget about it" required> Forget about it</label>
      </div>

      <div class="actions">
        <button type="submit" class="button" id="submitBtn" disabled>üöÄ Submit Answers</button>
      </div>
    </form>

    <div id="result" class="result-box"></div>
  </div>

  <script>
    // -------- Read URL context & fill hidden fields ----------
    const params = new URLSearchParams(window.location.search);
    const username = params.get('username') || '';
    const jobid    = params.get('jobid') || '';
    const role     = params.get('role') || 'Supervisors';

    document.querySelector('input[name="username"]').value = username;
    document.querySelector('input[name="jobid"]').value = jobid;
    document.querySelector('input[name="role"]').value = role;

    // Friendly header context
    const idText = [username, jobid].filter(Boolean).join(' ‚Ä¢ ');
    if (idText) document.getElementById('whoami').textContent = `üë§ ${idText}`;

    // -------- Progress logic ----------
    const TOTAL = 5;
    const progressBar = document.getElementById('progressBar');
    const progressPct = document.getElementById('progressPct');
    const answeredPill = document.getElementById('answeredPill');
    const submitBtn = document.getElementById('submitBtn');
    const starCountEl = document.getElementById('starCount');

    const form = document.getElementById('quizForm');
    const questions = ['q1','q2','q3','q4','q5'];

    function updateProgress() {
      let answered = 0;
      questions.forEach(q => {
        const checked = form.querySelector(`input[name="${q}"]:checked`);
        if (checked) answered++;
      });
      const pct = Math.round((answered / TOTAL) * 100);
      progressBar.style.width = pct + '%';
      progressPct.textContent = pct + '%';
      answeredPill.textContent = `${answered}/${TOTAL} answered`;
      submitBtn.disabled = answered !== TOTAL;
      // Stars for answering (pre-submit mini-reward)
      starCountEl.textContent = answered;
    }

    form.addEventListener('change', updateProgress);
    updateProgress();

    // -------- Scoring & Result ----------
    form.addEventListener('submit', function(e){
      e.preventDefault();

      // Correct answers
      const correct = {
        q1: "Document everything",
        q2: "Cybersecurity or IT team",
        q3: "Isolate if instructed",
        q4: "To support investigation",
        q5: "Follow up with IT and train staff"
      };

      let score = 0;
      Object.keys(correct).forEach(q => {
        if (form[q].value === correct[q]) score++;
      });

      // Gamified result message
      const resultBox = document.getElementById('result');
      resultBox.style.display = 'block';

      let msg = '';
      let badge = '';
      if (score === 5){
        msg = `üéâ Perfect! <strong>${score}/5</strong> ‚Äî You‚Äôre an Incident Response Master!`;
        badge = `<span class="badge">ü•á Incident Commander</span>`;
      } else if (score >= 4){
        msg = `‚úÖ Great job! <strong>${score}/5</strong> ‚Äî Nearly perfect!`;
        badge = `<span class="badge">ü•à Rapid Responder</span>`;
      } else if (score >= 3){
        msg = `üëç Solid try! <strong>${score}/5</strong> ‚Äî Keep sharpening your response playbook.`;
        badge = `<span class="badge">ü•â First Responder</span>`;
      } else {
        msg = `‚ö†Ô∏è You scored <strong>${score}/5</strong>. Review and try again ‚Äî you‚Äôve got this!`;
        badge = `<span class="badge">üîÅ Keep Training</span>`;
      }
      resultBox.innerHTML = `${msg}<br>${badge}`;

      // Save minimal local progress (optional)
      try{
        const key = 'completedTrainingsSupervisor';
        const list = JSON.parse(localStorage.getItem(key) || '[]');
        const title = 'Incident Response (Supervisors)';
        if (!list.includes(title)){
          list.push(title);
          localStorage.setItem(key, JSON.stringify(list));
        }
      }catch(err){/* non-blocking */}

      // Redirect to CENTRAL results page with full context
      const query = new URLSearchParams({
        username: username || '',
        jobid:    jobid || '',
        role:     role || 'Supervisors',
        topic:    'Incident Response',
        score:    String(score)
      });
      // slight delay so users see the badge flash
      setTimeout(()=> {
        window.location.href = `./results.html?${query.toString()}`;
      }, 800);
    });
  </script>
</body>
</html>
